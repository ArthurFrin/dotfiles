#!/bin/bash

if (($# == 0)); then
  echo "Usage: launch-or-focus-tui [pattern] [cmd]"
  exit 1
fi

PATTERN="$1"
CMD="${2:-$1}"

# Cherche une fenêtre dont le titre ou la classe correspond au pattern
WINDOW=$(hyprctl clients -j | jq -r --arg p "$PATTERN" '
  .[] |
  select(
    (.class  | test($p; "i")) or
    (.title  | test($p; "i"))
  ) |
  .address
' | head -n1)

if [[ -n "$WINDOW" ]]; then
  # Focus sur la fenêtre existante
  hyprctl dispatch focuswindow "address:$WINDOW"
else
  # Lance dans un terminal flottant via uwsm-app
  exec setsid uwsm-app -- xdg-terminal-exec --app-id="tui.$PATTERN" -e "$CMD"
fi
