#!/bin/bash

if (($# == 0)); then
  echo "Usage: launch-or-focus-tui [window-pattern] [launch-command]"
  exit 1
fi

WINDOW_PATTERN="$1"
CMD="${2:-$1}"

# Cherche une fenêtre dont le titre ou la classe correspond au pattern
WINDOW_ADDRESS=$(hyprctl clients -j | jq -r --arg p "$WINDOW_PATTERN" '
  .[] |
  select(
    (.class | test($p; "i")) or
    (.title | test($p; "i"))
  ) |
  .address
' | head -n1)

if [[ -n "$WINDOW_ADDRESS" ]]; then
  # Focus sur la fenêtre existante
  hyprctl dispatch focuswindow "address:$WINDOW_ADDRESS"
else
  # Lance un terminal en floating + centré
  hyprctl dispatch exec "[floating;center] foot -e $CMD"
fi
